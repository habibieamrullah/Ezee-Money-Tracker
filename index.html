<!DOCTYPE html>
<html>
	<head>
		<title>Ezee MT</title>
		
		<link rel="stylesheet" type="text/css" href="style.css">
		<link rel="stylesheet" type="text/css" href="css/font-awesome.css">
		
		<!-- Insert this line above script imports  -->
		<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
		<script src="jquery.js"></script>
		<!-- Insert this line after script imports -->
		<script>if (window.module) module = window.module;</script>
		
	</head>
	<body>
		
		<div class="screen" id="landing">
			<div class="vbleft">
				<div class="block" style="padding-bottom: 0;">
					<button class="btnround" onclick=ss("cn") title="Create New Account"><i class="fa fa-file-o"></i></button>
				</div>
				<div class="block" style="padding-bottom: 0;">
					<button class="btnround" onclick=ss("categories") title="Categories"><i class="fa fa-list"></i></button>
				</div>
				<div class="block" style="padding-bottom: 0;">
					<button class="btnround" onclick=ss("about") title="About"><i class="fa fa-question"></i></button>
				</div>
			</div>
			<div class="vbar">
				<div class="block">
					<h2 style="margin-left: 15px;">Your Accounts</h2>
					<div id="acclist"></div>
				</div>
			</div>
		</div>
		<div class="screen" id="cn">
			<div class="vbleft">
				<div class="block">
					<button class="btnround" onclick=ss("landing")><i class="fa fa-arrow-left"></i></button>
				</div>
			</div>
			<div class="vbar">
				<div class="block">
					<h2>Create New Account</h2>
					<div>
						<input placeholder="Type a name" id="newaccname" type="text"><br>
						<input placeholder="Current balance" id="curaccbal" type="number" value="0"><br>
						<input placeholder="Currency Symbol" id="cursymbol" type="text" value="$" width="20">
					</div>
					<div><button onclick="savenew()"><i class="fa fa-file-o"></i> Create Now</button></div>
				</div>
			</div>
		</div>
		<div class="screen" id="account">
			<div class="vbleft">
				<div class="block" style="padding-bottom: 0;">
					<button class="btnround" onclick=ss("landing")><i class="fa fa-arrow-left"></i></button>
				</div>
				<div class="block" style="padding-bottom: 0;">
					<button class="btnround" onclick=ss("landing")><i class="fa fa-plus"></i></button>
				</div>
				<div class="block" style="padding-bottom: 0;">
					<button class="btnround" onclick=ss("landing")><i class="fa fa-minus"></i></button>
				</div>
				<div class="block" style="padding-bottom: 0;">
					<button class="btnround" onclick="delacc()"><i class="fa fa-trash" style='color: red;'></i></button>
				</div>
			</div>
			<div class="vbar">
				<div class="block">
					<div id="accountpage"></div>
				</div>
			</div>
		</div>
		<div class="screen" id="resapp">
			<div class="vbleft" >
				<div class="block">
					<button class="btnround" onclick=ss("landing")><i class="fa fa-arrow-left"></i></button>
				</div>
			</div>
			<div class="vbar">
				<div class="block">
					<h2>Reset This App</h2>
					<p>WARNING : By resetting this app you will lose all your data saved in this app. Are you sure?</p>
					<div><button onclick="resapp()" style="background-color:#e53939;"><i class="fa fa-trash"></i> Yes, reset now</button></div>
				</div>
			</div>
		</div>
		<div class="screen" id="categories">
			<div class="vbleft" >
				<div class="block">
					<button class="btnround" onclick=ss("landing")><i class="fa fa-arrow-left"></i></button>
				</div>
			</div>
			<div class="vbar">
				<div class="block">
					<h2>Categories</h2>
					<div style="display: inline-block; inline-block; vertical-align: top;">
						<h3>Incomes</h3>
						<div id="incatlist"></div>
						<div><input placeholder="Type a name" id="incat"></div>
						<div><button onclick="addincat()"><i class="fa fa-file-o"></i> Add Income Category</button></div>
					</div>
					<div style="display: inline-block; vertical-align: top; margin-left: 10px; padding-left: 10px; border-left: 1px solid white;">
						<h3>Expenses</h3>
						<div id="excatlist"></div>
						<div><input placeholder="Type a name" id="excat"></div>
						<div><button onclick="addexcat()"><i class="fa fa-file-o"></i> Add Expense Category</button></div>
					</div>
				</div>
			</div>
		</div>
		<div class="screen" id="about">
			<div class="vbleft" >
				<div class="block">
					<button class="btnround" onclick=ss("landing")><i class="fa fa-arrow-left"></i></button>
				</div>
			</div>
			<div class="vbar">
				<div class="block">
					<h2>About</h2>
					<p>Ezee Money Tracker is a free personal or small business money management software.</p>
					<p>Did you ever feel regret when you see you wallet is empty and you don't know where all your money spent? Here this software is made for: to track your expenses.</p>
					<h2>Disclaimer</h2>
					<p>I am just a common programmer that love coding something useful for you. I've made this software as good as I could. However I can not guarantee that this software is bug/problem free. Please use this software at your own risk. I'm not responsible for any losses or damages caused by using this software.</p>
					<h2>Support This Software Development</h2>
					<p>I love coding. If you love using this free software, would you please help me to make it better by donating to my PayPal account? So I can still working on what I love to do. Here is the link: <a href="https://www.paypal.me/habibieamrullah">https://www.paypal.me/habibieamrullah</a></p>
					<h2>Contact me</h2>
					<p>Should you have any inquiry, please don't hesitate to contact me: <a href="mailto:habibieamrullah@gmail.com">habibieamrullah@gmail.com</a></p>
				</div>
			</div>
		</div>
		
		<div id="dimpage"></div>
		<div id="appalert"></div>
		<script>
			function resapp(){
				localStorage.clear()
				location.reload()
			}
			//resapp()
			var appdata = {
				acc : [],
				catin : [],
				catex : []
			}
			
			var currentaccount = 0;
			function openacc(n){
				currentaccount = n;
				ss("account")
			}
			
			function delacc(){
				$("#dimpage").html("<div class='block'><h2>Delete Account</h2><p>Are you sure you are willing to delete this account?</p><div><button style='margin-right: 5px;' onclick='closedp()'>Cancel</button><button onclick='delaccok("+currentaccount+")'>Sure</button></div></div>").fadeIn()
			}
			
			function delaccok(n){
				appdata.acc.splice(n, 1)
				savedata()
				ss("landing")
				$("#dimpage").fadeOut()
			}
			
			if(localStorage.getItem("appdata") === null){
				savedata()
			}else{
				appdata = JSON.parse(localStorage.getItem("appdata"))
			}
			
			function savedata(){
				localStorage.setItem("appdata", JSON.stringify(appdata))
			}
			
			function savenew(){
				var nn = refineinput($("#newaccname").val())
				var bl = $("#curaccbal").val();
				bl = parseFloat(refineinput(bl))
				if(isNaN(bl))
					bl = 0
				var sb = $("#cursymbol").val().substring(0,4)
				if(nn != ""){
					appdata.acc.push({ name : nn, bal : bl, symb : sb })
					sAlert("New account created.")
					savedata()
					ss("landing")
				}else{
					sAlert("Please type a name.")
				}
			}
		
			function ss(id){
				$(".screen").hide()
				$("#"+id).show()
				
				switch(id){
					case "cn" :
						$("#newaccname").val("");
						$("#curaccbal").val("");
						$("#cursymbol").val("");
						break;
					case "landing" :
						if(appdata.acc.length > 0){
							data = ""
							for(var i = 0; i < appdata.acc.length; i++){
								data += "<div class='accicon' onclick='openacc("+i+")'><div style='display: inline-block; margin-right: 10px; vertical-align: top;'><i class='fa fa-briefcase'></i></div><div style='display: inline-block; vertical-align: top;'>" + appdata.acc[i].name + "<br><span style='font-size: 10px;'>"+appdata.acc[i].symb+" "+tsep(appdata.acc[i].bal)+"</span></div></div>"
							}
							$("#acclist").html(data)
							break
						}else{
							$("#acclist").html("<div class='accicon' onclick='ss(\"cn\")'><i class='fa fa-file-o'> </i> Create New Account</div>")
						}
						break;
					case "categories" :
						$("#incat").val("")
						$("#excat").val("")
						$("#incatlist").html(function(){
							if(appdata.catin.length > 0){
								txt = "";
								for(var i = 0; i < appdata.catin.length; i++){
									txt += "<div class='catblock'><i class='fa fa-trash' style='color: red; cursor: pointer; margin-right: 15px;' title='Delete this category' onclick='delcatin("+i+")'></i><i class='fa fa-pencil' style='margin-right: 15px; cursor: pointer;' title='Edit category\'s name' onclick='editcatin("+i+")'></i>"+appdata.catin[i]+"</div>"
								}
								return txt
							}else
								return "Please add a category..."
						})
						$("#excatlist").html(function(){
							if(appdata.catex.length > 0){
								txt = "";
								for(var i = 0; i < appdata.catex.length; i++){
									txt += "<div class='catblock'><i class='fa fa-trash' style='color: red; margin-right: 15px; cursor: pointer;' onclick='delcatex("+i+")' title='Delete this category'></i><i class='fa fa-pencil' style='margin-right: 15px; cursor: pointer;' title='Edit category\'s name' onclick='editcatex("+i+")'></i>"+appdata.catex[i]+"</div>"
								}
								return txt
							}else
								return "Please add a category..."
						})
						break;
					case "account" :
						$("#accountpage").html("<h2>"+appdata.acc[currentaccount].name+" <i class='fa fa-pencil-square-o' style='margin-left: 10px; cursor: pointer;' title='Edit' onclick='editaccname("+currentaccount+")'></i></h2><h4>Balance: "+appdata.acc[currentaccount].symb+" "+tsep(appdata.acc[currentaccount].bal)+"</h4></div>")
						break;
				}
			}
			
			function addincat(){
				if(refineinput($("#incat").val()) != ""){
					appdata.catin.push(refineinput($("#incat").val()));
					savedata()
					ss("categories")
					sAlert("New category added.")
				}
			}
			
			function delcatin(n){
				appdata.catin.splice(n, 1);
				savedata()
				ss("categories")
				sAlert("Succesfully emoved.")
			}
			
			function addexcat(){
				if(refineinput($("#excat").val()) != ""){
					appdata.catex.push(refineinput($("#excat").val()));
					savedata()
					ss("categories")
					sAlert("New category added.")
				}
			}
			
			function delcatex(n){
				appdata.catex.splice(n, 1);
				savedata()
				ss("categories")
				sAlert("Succesfully emoved.")
			}
			
			function editcatin(n){
				var name = appdata.catin[n];
				$("#dimpage").html("<div class='block'><h2>Edit</h2><div><input placeholder='Type a name' value='"+name+"' id='editedcatname'></div><div><button style='margin-right: 5px;' onclick='closedp()'>Cancel</button><button onclick='updatecatin("+n+")'>Save</button></div></div>").fadeIn();
			}
			
			function updatecatin(n){
				var newcatname = refineinput($("#editedcatname").val())
				if(newcatname != ""){
					appdata.catin[n] = newcatname
					savedata()
					ss("categories")
					$("#dimpage").fadeOut()
					sAlert("Successfully updated.")
				}
			}
			
			function editcatex(n){
				var name = appdata.catex[n];
				$("#dimpage").html("<div class='block'><h2>Edit</h2><div><input placeholder='Type a name' value='"+name+"' id='editedcatname'></div><div><button style='margin-right: 5px;' onclick='closedp()'>Cancel</button><button onclick='updatecatex("+n+")'>Save</button></div></div>").fadeIn();
			}
			
			function updatecatex(n){
				var newcatname = refineinput($("#editedcatname").val())
				if(newcatname != ""){
					appdata.catex[n] = newcatname;
					savedata()
					ss("categories")
					$("#dimpage").fadeOut()
					sAlert("Successfully updated.")
				}
			}
			
			function editaccname(n){
				$("#dimpage").html("<div class='block'><h2>Edit</h2><div><label>Account Name:</label><br><input placeholder='Type a name' value='"+appdata.acc[n].name+"' id='editedaccname'></div><div><label>Currency Symbol:</label><br><input placeholder='Currency Symbol' value='"+appdata.acc[n].symb+"' id='editedaccsymbol'></div><div><button style='margin-right: 5px;' onclick='closedp()'>Cancel</button><button onclick='updateaccname("+n+")'>Save</button></div></div>").fadeIn()
			}
			
			function updateaccname(n){
				var newcatname = refineinput($("#editedaccname").val())
				var newsymbol = $("#editedaccsymbol").val().substring(0,4);
				if(newcatname != ""){
					appdata.acc[n].name = newcatname
					appdata.acc[n].symb = newsymbol
					savedata()
					openacc(n)
					$("#dimpage").fadeOut()
					sAlert("Successfully updated.")
				}
			}
			
			function closedp(){
				$("#dimpage").fadeOut()
			}
			
			ss("landing")
			
			$(window).resize(function() {
				resizevbar()
			})
			function resizevbar(){
				$(".vbar").css({ width : (innerWidth-95)+"px" })
			}
			resizevbar()
			
			function sAlert(x){
				$("#appalert").html(x).fadeIn(function(){
					setTimeout(function(){
						$("#appalert").fadeOut()
					}, 1500)
				})
			}
			
			function refineinput(txt){
				var validtext = ""
				var numregex = /^([0-9])$/
				var letterregex = /^[a-zA-Z\-\s\.]+$/
				for(var i = 0; i < txt.length; i++){
					if(!numregex.test(txt[i]) && !letterregex.test(txt[i])){
						validtext += ""
					}else{
						validtext += txt[i]
					}
				}
				return validtext
			}
			
			function tsep(x){
				return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")
			}
			
			//electron bridge
			const { ipcRenderer } = require("electron")
			ipcRenderer.on("allaccounts", (event, arg)=>{
				ss("landing")
			})
			ipcRenderer.on("createnew", (event, arg)=>{
				ss("cn")
			})
			ipcRenderer.on("resetapp", (event, arg)=>{
				ss("resapp")
			})
			ipcRenderer.on("about", (event, arg)=>{
				ss("about")
			})
			ipcRenderer.on("categories", (event, arg)=>{
				ss("categories")
			})
			
			const shell = require('electron').shell;
			// assuming $ is jQuery
			$(document).on('click', 'a[href^="http"]', function(event) {
				event.preventDefault();
				shell.openExternal(this.href);
			});
		</script>
	</body>
</html>